<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Candidate Reports Viewer</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121826;
      --muted:#8aa0b5;
      --text:#e8f0ff;
      --border:rgba(255,255,255,0.08);
      --good:#2dd4bf;
      --warn:#fbbf24;
      --bad:#fb7185;
      --chip:rgba(255,255,255,0.06);
      --scrollTrack: rgba(255,255,255,0.06);
      --scrollThumb: rgba(255,255,255,0.18);
      --scrollThumbHover: rgba(255,255,255,0.28);
      --shadow: 0 18px 40px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:14px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }

    /* Scrollbar styling */
    *::-webkit-scrollbar{ width:10px; height:10px; }
    *::-webkit-scrollbar-track{ background:var(--scrollTrack); border-radius:999px; }
    *::-webkit-scrollbar-thumb{
      background:var(--scrollThumb);
      border-radius:999px;
      border:2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }
    *::-webkit-scrollbar-thumb:hover{ background:var(--scrollThumbHover); }
    *{ scrollbar-width: thin; scrollbar-color: var(--scrollThumb) var(--scrollTrack); }

    header{
      position:sticky; top:0; z-index:5;
      background:rgba(11,15,20,0.85);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--border);
      padding:12px 16px;
      display:flex; gap:10px; align-items:center;
    }
    header .title{font-weight:900; letter-spacing:0.2px;}
    header .spacer{flex:1;}
    #fileInput{display:none;}

    .field{
      border:1px solid var(--border);
      background:rgba(18,24,38,0.65);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      min-width:220px;
      outline:none;
    }

    .btn{
      border:1px solid var(--border);
      background:rgba(18,24,38,0.9);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.08);}

    /* Layout */
    .layout{
      display:grid;
      grid-template-columns:320px 1fr;
      gap:0;
      min-height:calc(100vh - 56px);
    }

    /* Sidebar fixed to viewport */
    .sidebar{
      border-right:1px solid var(--border);
      background:rgba(18,24,38,0.35);
      padding:12px;
      height:calc(100vh - 56px);
      position:sticky;
      top:56px;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden; /* internal list scrolls */
    }

    .main{
      padding:14px;
      overflow:visible; /* page scroll */
      min-height:calc(100vh - 56px);
    }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .muted{color:var(--muted);}

    .chip{
      display:inline-flex; align-items:center;
      padding:3px 8px; border-radius:999px;
      background:var(--chip); border:1px solid var(--border);
      font-size:12px; gap:6px; white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:999px;display:inline-block;}
    .dot.good{background:var(--good);}
    .dot.warn{background:var(--warn);}
    .dot.bad{background:var(--bad);}

    .card{
      background:rgba(18,24,38,0.65);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      box-shadow: var(--shadow);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:10px;
      margin-bottom:12px;
    }

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr;}
      .sidebar{
        position:relative;
        top:auto;
        height:auto;
        max-height:50vh;
        border-right:none;
        border-bottom:1px solid var(--border);
      }
      .grid{grid-template-columns:repeat(2,minmax(0,1fr));}
    }

    .kpi .label{color:var(--muted);font-size:12px;}
    .kpi .value{font-size:20px;font-weight:900;margin-top:2px;}

    /* Candidate list scrolls within sidebar */
    .list{
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
      flex:1;
      min-height:0;
      padding-right:2px;
    }
    .item{
      background:rgba(18,24,38,0.55);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      cursor:pointer;
    }
    .item:hover{filter:brightness(1.07);}
    .item.active{outline:2px solid rgba(45,212,191,0.35);}
    .itemTop{display:flex;justify-content:space-between;align-items:baseline;gap:10px;}

    .barWrap{display:flex;align-items:center;gap:10px;}
    .bar{
      height:8px; flex:1;
      background:rgba(255,255,255,0.06);
      border:1px solid var(--border);
      border-radius:999px;
      overflow:hidden;
    }
    .bar>div{height:100%;width:0%;background:rgba(45,212,191,0.8);}

    .sectionTitle{
      margin:14px 0 8px;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:0.08em;
    }

    table{
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius:12px;
      border:1px solid var(--border);
    }
    th,td{
      padding:8px 10px;
      border-bottom:1px solid var(--border);
      text-align:left;
      vertical-align:top;
    }
    th{color:var(--muted);font-weight:600;background:rgba(255,255,255,0.03);}
    tr:last-child td{border-bottom:none;}

    .twoCol{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }

    /* Report header */
    .reportHeader{
      position:sticky; top:0; z-index:3;
      background:rgba(18,24,38,0.92);
      backdrop-filter:blur(10px);
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin-bottom:10px;
    }

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
    .tab{
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      color:var(--text);
      padding:6px 10px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      font-size:12px;
    }
    .tab.active{outline:2px solid rgba(45,212,191,0.35);}

    .panel{display:none;}
    .panel.active{display:block;}

    ul{margin:0;padding-left:18px;}
    li{margin:6px 0;}

    .reportFooter{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      margin-top:12px;
    }

    /* === Key behavior: if nothing selected => show stats; if selected => show report === */
    body[data-mode="stats"] #reportFrame{display:none;}
    body[data-mode="report"] #statsFrame{display:none;}
    body[data-mode="report"] .grid{display:none;} /* hide KPI strip in report mode (keeps it clean) */
    body[data-mode="report"] .sidebar{background:rgba(18,24,38,0.25);}

    /* Optional: empty state styling */
    .empty{
      padding:14px;
      border:1px dashed var(--border);
      border-radius:14px;
      background:rgba(255,255,255,0.02);
      color:var(--muted);
    }
    #reportHeader {
    scroll-margin-top: 200px;
    }
  </style>
</head>

<body data-mode="stats">
<header>
  <div class="title">Candidate Reports</div>
  <input id="fileInput" type="file" multiple accept=".json,application/json" />
  <div class="spacer"></div>

  <input class="field" id="search" placeholder="Search candidateId / decision / classification..." />
  <select class="field" id="sort" style="min-width:200px">
    <option value="overallDesc">Sort: Overall score ↓</option>
    <option value="overallAsc">Sort: Overall score ↑</option>
    <option value="decision">Sort: Decision</option>
    <option value="tasksDesc">Sort: Tasks completed ↓</option>
    <option value="endDateDesc">Sort: End date ↓</option>
  </select>
</header>

<div class="layout">
  <aside class="sidebar">
    <div class="row">
      <span class="muted" id="countLabel">0 loaded</span>
      <span class="chip" id="hireRateChip"><span class="dot warn"></span><span>Hire rate: —</span></span>
    </div>

    <div class="list" id="list"></div>
  </aside>

  <main class="main">
    <div class="grid" id="kpiGrid">
      <div class="card kpi">
        <div class="label">Avg AI Leverage</div>
        <div class="value" id="kpiAi">—</div>
        <div class="muted" id="kpiAiSub">—</div>
      </div>
      <div class="card kpi">
        <div class="label">Avg Engineer Score</div>
        <div class="value" id="kpiEng">—</div>
        <div class="muted" id="kpiEngSub">—</div>
      </div>
      <div class="card kpi">
        <div class="label">Avg Problem Solver</div>
        <div class="value" id="kpiPs">—</div>
        <div class="muted" id="kpiPsSub">—</div>
      </div>
      <div class="card kpi">
        <div class="label">Avg Tasks Completed</div>
        <div class="value" id="kpiTasks">—</div>
        <div class="muted" id="kpiTasksSub">Across selected files</div>
      </div>
    </div>

    <div class="twoCol">
      <!-- General stats frame -->
      <div class="card" id="statsFrame">
        <div class="sectionTitle">Decision distribution</div>
        <div id="decisionTableWrap"></div>

        <div class="sectionTitle">Average foundational signals</div>
        <div id="signalTableWrap"></div>

        <div class="sectionTitle">Top risk flags</div>
        <div id="riskTableWrap"></div>

        <div id="emptyHint" class="empty" style="display:none; margin-top:12px;">
          Load JSON files with the hidden shortcut.
        </div>
      </div>

      <!-- Selected report frame -->
      <div class="card" id="reportFrame">
        <div class="sectionTitle">Selected report</div>

        <div class="reportHeader" id="reportHeader">
          <div id="selectedHeader" class="row"></div>

          <div class="tabs" id="tabs">
            <div class="tab active" data-tab="overview">Overview</div>
            <div class="tab" data-tab="signals">Signals</div>
          </div>
        </div>

        <div id="panel_overview" class="panel active"></div>
        <div id="panel_signals" class="panel"></div>

        <div class="reportFooter">
          <button class="btn" id="backBtn">Back</button>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
  /** @typedef {any} Report */
  const state = {
    reports: /** @type {Report[]} */ ([]),
    filtered: /** @type {Report[]} */ ([]),
    selectedIdx: -1
  };

  const el = (id) => document.getElementById(id);

  function safeNum(x, fallback = 0) {
    const n = Number(x);
    return Number.isFinite(n) ? n : fallback;
  }

  function getOverallScore(r) {
    const a = safeNum(r?.compositeScores?.aiLeverageScore?.score, NaN);
    const p = safeNum(r?.compositeScores?.problemSolverScore?.score, NaN);
    const e = safeNum(r?.compositeScores?.engineerScore?.score, NaN);
    const arr = [a,p,e].filter(Number.isFinite);
    if (!arr.length) return 0;
    return arr.reduce((s,v)=>s+v,0)/arr.length;
  }

  // Strong hire > hire
  function decisionRank(decision) {
    const d = String(decision || "").toUpperCase();
    if (d.includes("STRONG_HIRE")) return 5;
    if (d === "HIRE" || d.includes(" HIRE")) return 4;
    if (d.includes("LEAN_HIRE")) return 3;
    if (d.includes("LEAN_NO_HIRE")) return 2;
    if (d.includes("NO_HIRE") || d.includes("REJECT")) return 1;
    return 0;
  }

  function decisionDotClass(decision) {
    const r = decisionRank(decision);
    if (r >= 4) return "good";
    if (r === 3) return "warn";
    return "bad";
  }

  function fmt(n, digits=0) {
    if (!Number.isFinite(n)) return "—";
    return n.toFixed(digits);
  }

  function setMode(mode) {
    document.body.dataset.mode = mode; // "stats" | "report"
  }

  function setActiveTab(tab) {
    el("tabs").querySelectorAll(".tab").forEach(t => {
      t.classList.toggle("active", t.dataset.tab === tab);
    });
    ["overview","signals"].forEach(k => {
      el("panel_"+k).classList.toggle("active", k === tab);
    });
  }

  el("tabs").addEventListener("click", (e) => {
    const t = e.target.closest(".tab");
    if (!t) return;
    setActiveTab(t.dataset.tab);
  });

  el("backBtn").addEventListener("click", () => {
    state.selectedIdx = -1;
    renderList();
    clearReport();
    setMode("stats");
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  function clearReport() {
    el("selectedHeader").innerHTML = "";
    el("panel_overview").innerHTML = "";
    el("panel_signals").innerHTML = "";
  }

  function renderList() {
    const list = el("list");
    list.innerHTML = "";
    const items = state.filtered;

    el("countLabel").textContent = `${items.length} loaded (filtered) / ${state.reports.length} total`;

    items.forEach((r, idx) => {
      const decision = r?.hiringRecommendation?.decision ?? "—";
      const overall = getOverallScore(r);
      const tasks = r?.evaluationPeriod?.tasksCompleted ?? "—";
      const endDate = r?.evaluationPeriod?.endDate ?? "—";
      const active = (idx === state.selectedIdx) ? "active" : "";
      const dot = decisionDotClass(decision);

      const div = document.createElement("div");
      div.className = `item ${active}`;
      div.innerHTML = `
        <div class="itemTop">
          <div style="font-weight:900">${r?.candidateId ?? "unknown"}</div>
          <span class="chip"><span class="dot ${dot}"></span>${decision}</span>
        </div>
        <div class="muted" style="margin-top:6px">
          Overall: <b style="color:var(--text)">${fmt(overall,0)}</b> · Tasks: <b style="color:var(--text)">${tasks}</b> · End: ${endDate}
        </div>
        <div style="margin-top:8px" class="barWrap">
          <div class="bar"><div style="width:${Math.max(0, Math.min(100, overall))}%"></div></div>
          <span class="muted">${fmt(overall,0)}</span>
        </div>
      `;
      div.addEventListener("click", () => {
        state.selectedIdx = idx;
        renderList();
        renderSelected();
        setMode("report");
        setActiveTab("overview");
        el("reportHeader")?.scrollIntoView({ behavior: "smooth", block: "start" });
      });
      list.appendChild(div);
    });
  }

  function computeAnalytics(reports) {
    const decisions = new Map();
    const riskFlags = new Map();

    let sumAi=0, sumEng=0, sumPs=0, sumTasks=0;
    let nAi=0, nEng=0, nPs=0, nTasks=0;

    const sigSums = {
      contextQuality: 0,
      analysisDepth: 0,
      criticalThinking: 0,
      testCulture: 0,
      codeQuality: 0,
      decisionQuality: 0
    };
    const sigCounts = {
      contextQuality: 0,
      analysisDepth: 0,
      criticalThinking: 0,
      testCulture: 0,
      codeQuality: 0,
      decisionQuality: 0
    };

    let hireCount = 0;
    let strongHireCount = 0;

    for (const r of reports) {
      const dec = String(r?.hiringRecommendation?.decision ?? "UNKNOWN");
      decisions.set(dec, (decisions.get(dec) || 0) + 1);

      const risks = Array.isArray(r?.riskFlags) ? r.riskFlags : [];
      for (const rf of risks) {
        const k = String(rf);
        riskFlags.set(k, (riskFlags.get(k) || 0) + 1);
      }

      const ai = safeNum(r?.compositeScores?.aiLeverageScore?.score, NaN);
      const ps = safeNum(r?.compositeScores?.problemSolverScore?.score, NaN);
      const eng = safeNum(r?.compositeScores?.engineerScore?.score, NaN);
      if (Number.isFinite(ai)) { sumAi += ai; nAi++; }
      if (Number.isFinite(ps)) { sumPs += ps; nPs++; }
      if (Number.isFinite(eng)) { sumEng += eng; nEng++; }

      const tasks = safeNum(r?.evaluationPeriod?.tasksCompleted, NaN);
      if (Number.isFinite(tasks)) { sumTasks += tasks; nTasks++; }

      const fs = r?.foundationalSignals || {};
      for (const k of Object.keys(sigSums)) {
        const sc = safeNum(fs?.[k]?.score, NaN);
        if (Number.isFinite(sc)) { sigSums[k] += sc; sigCounts[k] += 1; }
      }

      const up = dec.toUpperCase();
      if (up.includes("STRONG_HIRE")) strongHireCount++;
      if (up.includes("HIRE") && !up.includes("NO_HIRE")) hireCount++;
    }

    const decisionRows = [...decisions.entries()]
      .sort((a,b)=>{
        const ra = decisionRank(a[0]), rb = decisionRank(b[0]);
        if (rb !== ra) return rb - ra;
        if (b[1] !== a[1]) return b[1] - a[1];
        return String(a[0]).localeCompare(String(b[0]));
      });

    const riskRows = [...riskFlags.entries()].sort((a,b)=>b[1]-a[1]).slice(0, 10);

    const sigRows = Object.keys(sigSums).map(k => {
      const avg = sigCounts[k] ? (sigSums[k] / sigCounts[k]) : NaN;
      return [k, avg];
    }).sort((a,b)=>(b[1]||0)-(a[1]||0));

    const hireRate = reports.length ? (hireCount / reports.length) : 0;

    return {
      avgAi: nAi ? sumAi/nAi : NaN,
      avgPs: nPs ? sumPs/nPs : NaN,
      avgEng: nEng ? sumEng/nEng : NaN,
      avgTasks: nTasks ? sumTasks/nTasks : NaN,
      decisionRows,
      riskRows,
      sigRows,
      hireRate,
      strongHireCount,
      hireCount
    };
  }

  function renderAnalytics() {
    const a = computeAnalytics(state.filtered);

    el("kpiAi").textContent = fmt(a.avgAi, 1);
    el("kpiEng").textContent = fmt(a.avgEng, 1);
    el("kpiPs").textContent = fmt(a.avgPs, 1);
    el("kpiTasks").textContent = fmt(a.avgTasks, 1);

    el("kpiAiSub").textContent = `${state.filtered.length} reports`;
    el("kpiEngSub").textContent = `Across selected files`;
    el("kpiPsSub").textContent = `Strong hire > hire`;

    const chip = el("hireRateChip");
    const pct = Math.round(a.hireRate * 100);
    const dotClass = pct >= 70 ? "good" : pct >= 45 ? "warn" : "bad";
    chip.innerHTML = `<span class="dot ${dotClass}"></span><span>Hire rate: ${pct}%</span>`;

    const total = state.filtered.length || 1;

    el("decisionTableWrap").innerHTML = `
      <table>
        <thead><tr><th>Decision</th><th>Count</th><th>Share</th></tr></thead>
        <tbody>
          ${a.decisionRows.map(([d,c]) => {
            const share = (c/total)*100;
            return `<tr>
              <td><span class="chip"><span class="dot ${decisionDotClass(d)}"></span>${d}</span></td>
              <td>${c}</td>
              <td>
                <div class="barWrap">
                  <div class="bar"><div style="width:${Math.min(100, Math.max(0, share))}%"></div></div>
                  <span class="muted">${share.toFixed(0)}%</span>
                </div>
              </td>
            </tr>`;
          }).join("")}
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">
        Strong Hire: <b style="color:var(--text)">${a.strongHireCount}</b> ·
        Hire (incl. Strong/Lean): <b style="color:var(--text)">${a.hireCount}</b> ·
        Total: <b style="color:var(--text)">${state.filtered.length}</b>
      </div>
    `;

    const niceName = (k) => ({
      contextQuality: "Context Quality",
      analysisDepth: "Analysis Depth",
      criticalThinking: "Critical Thinking",
      testCulture: "Test Culture",
      codeQuality: "Code Quality",
      decisionQuality: "Decision Quality"
    }[k] || k);

    el("signalTableWrap").innerHTML = `
      <table>
        <thead><tr><th>Signal</th><th>Avg score</th></tr></thead>
        <tbody>
          ${a.sigRows.map(([k,avg]) => `
            <tr>
              <td>${niceName(k)}</td>
              <td>
                <div class="barWrap">
                  <div class="bar"><div style="width:${Math.min(100, Math.max(0, avg||0))}%"></div></div>
                  <span class="muted">${fmt(avg,0)}</span>
                </div>
              </td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;

    el("riskTableWrap").innerHTML = a.riskRows.length ? `
      <table>
        <thead><tr><th>Risk flag</th><th>Count</th></tr></thead>
        <tbody>
          ${a.riskRows.map(([k,c]) => `<tr><td>${k}</td><td>${c}</td></tr>`).join("")}
        </tbody>
      </table>
    ` : `<div class="muted">No risk flags in filtered selection.</div>`;

    el("emptyHint").style.display = state.reports.length ? "none" : "block";
  }

  function renderSelected() {
    const r = state.filtered[state.selectedIdx];
    if (!r) return;

    const decision = r?.hiringRecommendation?.decision ?? "—";
    const conf = safeNum(r?.hiringRecommendation?.confidence, NaN);
    const overall = getOverallScore(r);
    const dot = decisionDotClass(decision);

    el("selectedHeader").innerHTML = `
      <div style="font-weight:900; font-size:16px">${r?.candidateId ?? "unknown"}</div>
      <span class="chip"><span class="dot ${dot}"></span>${decision}</span>
      <span class="chip">Overall ${fmt(overall,0)}</span>
      <span class="chip">Confidence ${Number.isFinite(conf) ? conf.toFixed(2) : "—"}</span>
      <span class="chip">${r?.behavioralClassification ?? "—"}</span>
      <span class="chip">Tasks ${r?.evaluationPeriod?.tasksCompleted ?? "—"}</span>
      <span class="chip">${r?.evaluationPeriod?.startDate ?? "—"} → ${r?.evaluationPeriod?.endDate ?? "—"}</span>
    `;

    const strengths = Array.isArray(r?.strengths) ? r.strengths : [];
    const improvements = Array.isArray(r?.areasForImprovement) ? r.areasForImprovement : [];
    const risks = Array.isArray(r?.riskFlags) ? r.riskFlags : [];
    const rationale = r?.hiringRecommendation?.rationale ?? "—";

    el("panel_overview").innerHTML = `
      <div class="card" style="margin-bottom:10px; box-shadow:none; background:rgba(255,255,255,0.03)">
        <div class="sectionTitle" style="margin-top:0">Recommendation</div>
        <div style="font-size:14px">${rationale}</div>
      </div>

      <div class="card" style="box-shadow:none; background:rgba(255,255,255,0.03); margin-bottom:10px;">
        <div class="sectionTitle" style="margin-top:0">Strengths</div>
        ${strengths.length ? `<ul>${strengths.map(s=>`<li>${s}</li>`).join("")}</ul>` : `<div class="muted">—</div>`}
      </div>

      <div class="card" style="box-shadow:none; background:rgba(255,255,255,0.03); margin-bottom:10px;">
        <div class="sectionTitle" style="margin-top:0">Areas for improvement</div>
        ${improvements.length ? `<ul>${improvements.map(s=>`<li>${s}</li>`).join("")}</ul>` : `<div class="muted">—</div>`}
      </div>

      <div class="card" style="box-shadow:none; background:rgba(255,255,255,0.03)">
        <div class="sectionTitle" style="margin-top:0">Risk flags</div>
        ${risks.length ? `<div class="row">${risks.map(rf=>`<span class="chip"><span class="dot warn"></span>${rf}</span>`).join("")}</div>` : `<div class="muted">None</div>`}
      </div>
    `;

    const fs = r?.foundationalSignals || {};
    const rows = [
      ["Context Quality", fs?.contextQuality?.score],
      ["Analysis Depth", fs?.analysisDepth?.score],
      ["Critical Thinking", fs?.criticalThinking?.score],
      ["Test Culture", fs?.testCulture?.score],
      ["Code Quality", fs?.codeQuality?.score],
      ["Decision Quality", fs?.decisionQuality?.score]
    ].map(([name, score]) => {
      const v = safeNum(score, NaN);
      const width = Number.isFinite(v) ? Math.max(0, Math.min(100, v)) : 0;
      return `
        <tr>
          <td>${name}</td>
          <td>
            <div class="barWrap">
              <div class="bar"><div style="width:${width}%"></div></div>
              <span class="muted">${fmt(v,0)}</span>
            </div>
          </td>
        </tr>
      `;
    }).join("");

    const comp = r?.compositeScores || {};
    const compRows = [
      ["AI Leverage", comp?.aiLeverageScore?.score, comp?.aiLeverageScore?.description],
      ["Problem Solver", comp?.problemSolverScore?.score, comp?.problemSolverScore?.description],
      ["Engineer", comp?.engineerScore?.score, comp?.engineerScore?.description]
    ].map(([name, score, desc]) => {
      const v = safeNum(score, NaN);
      const width = Number.isFinite(v) ? Math.max(0, Math.min(100, v)) : 0;
      return `
        <tr>
          <td>${name}</td>
          <td>
            <div class="barWrap">
              <div class="bar"><div style="width:${width}%"></div></div>
              <span class="muted">${fmt(v,0)}</span>
            </div>
            <div class="muted" style="margin-top:4px">${desc || ""}</div>
          </td>
        </tr>
      `;
    }).join("");

    el("panel_signals").innerHTML = `
      <div class="card" style="margin-bottom:10px; box-shadow:none; background:rgba(255,255,255,0.03)">
        <div class="sectionTitle" style="margin-top:0">Composite Scores</div>
        <table>
          <thead><tr><th>Score</th><th>Details</th></tr></thead>
          <tbody>${compRows}</tbody>
        </table>
      </div>
      <div class="card" style="box-shadow:none; background:rgba(255,255,255,0.03)">
        <div class="sectionTitle" style="margin-top:0">Foundational Signals</div>
        <table>
          <thead><tr><th>Signal</th><th>Score</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    `;
  }

  function applyFilterSort() {
    const q = el("search").value.trim().toLowerCase();
    const sort = el("sort").value;

    let arr = [...state.reports];

    if (q) {
      arr = arr.filter(r => {
        const fields = [
          r?.candidateId,
          r?.hiringRecommendation?.decision,
          r?.behavioralClassification,
          (Array.isArray(r?.riskFlags) ? r.riskFlags.join(", ") : ""),
        ].map(x => String(x || "").toLowerCase());
        return fields.some(s => s.includes(q));
      });
    }

    const cmpStr = (a,b) => String(a).localeCompare(String(b));
    arr.sort((ra, rb) => {
      if (sort === "overallDesc") return getOverallScore(rb) - getOverallScore(ra);
      if (sort === "overallAsc") return getOverallScore(ra) - getOverallScore(rb);
      if (sort === "tasksDesc") return safeNum(rb?.evaluationPeriod?.tasksCompleted,0) - safeNum(ra?.evaluationPeriod?.tasksCompleted,0);
      if (sort === "endDateDesc") return cmpStr(rb?.evaluationPeriod?.endDate ?? "", ra?.evaluationPeriod?.endDate ?? "");
      if (sort === "decision") return decisionRank(rb?.hiringRecommendation?.decision) - decisionRank(ra?.hiringRecommendation?.decision);
      return 0;
    });

    state.filtered = arr;
  }

  function renderAll() {
    applyFilterSort();
    renderAnalytics();
    renderList();

    // mode based on selection
    if (state.selectedIdx >= 0 && state.filtered[state.selectedIdx]) {
      renderSelected();
      setMode("report");
    } else {
      clearReport();
      setMode("stats");
    }
  }

  async function readJsonFile(file) {
    const text = await file.text();
    const data = JSON.parse(text);
    if (Array.isArray(data)) return data;
    return [data];
  }

  el("fileInput").addEventListener("change", async (e) => {
    const files = [...(e.target.files || [])];
    if (!files.length) return;

    const all = [];
    for (const f of files) {
      try {
        const items = await readJsonFile(f);
        for (const r of items) all.push(r);
      } catch (err) {
        console.warn("Failed to parse:", f.name, err);
        alert(`Failed to parse ${f.name}. Make sure it is valid JSON.`);
      }
    }

    // De-dup by candidateId + period endDate
    const seen = new Set();
    const dedup = [];
    for (const r of all) {
      const key = `${r?.candidateId || "?"}::${r?.evaluationPeriod?.endDate || "?"}`;
      if (seen.has(key)) continue;
      seen.add(key);
      dedup.push(r);
    }

    state.reports = dedup;
    state.filtered = dedup;
    state.selectedIdx = -1;

    renderAll();
    e.target.value = "";
  });

  el("search").addEventListener("input", () => { state.selectedIdx = -1; renderAll(); });
  el("sort").addEventListener("change", () => { state.selectedIdx = -1; renderAll(); });

  function isMac(){ return navigator.platform.toUpperCase().includes("MAC"); }

  function loadSampleHidden(){
    state.reports = [
      {
        candidateId: "cand_sample_01",
        evaluationPeriod: { startDate: "2026-02-20", endDate: "2026-02-27", tasksCompleted: 5 },
        foundationalSignals: {
          contextQuality: { score: 84, fileCountAvg: 4.2, avgPromptLength: 512, questionsAsked: 6, clarityRating: 0.88 },
          analysisDepth: { score: 79, avgTimeToDecisionMs: 2840, followUpQuestions: 4, modificationRate: 0.62 },
          criticalThinking: { score: 87, rejectionRate: 0.28, highConfidenceRejectionRate: 0.11, modificationCount: 13, acceptedAfterModification: 9 },
          testCulture: { score: 91, testsRunBeforeAccept: 0.75, testsPassRateAfterEdit: 0.94, testCoverageChangeAvg: 0.07 },
          codeQuality: { score: 83, complexityReductionAvg: 0.18, duplicationReductionAvg: 0.22, lintIssuesIntroduced: 0 },
          decisionQuality: { score: 89, postEditFailureRate: 0.06, rollbackRate: 0.04, bugIntroductions: 0 }
        },
        compositeScores: {
          aiLeverageScore: { score: 88, description: "Strategically accepts high-confidence suggestions while modifying where appropriate." },
          problemSolverScore: { score: 85, description: "Demonstrates strong analytical thinking, validates suggestions, and improves solutions." },
          engineerScore: { score: 90, description: "Consistently validates with tests and maintains code quality standards." }
        },
        behavioralClassification: "Thoughtful Collaborator → Problem Solver",
        riskFlags: [],
        strengths: ["Runs tests before and after applying AI suggestions", "Modifies AI output rather than blindly accepting"],
        areasForImprovement: ["Could ask clarifying questions slightly earlier in ambiguous tasks"],
        hiringRecommendation: { decision: "HIRE", confidence: 0.87, rationale: "High problem-solving ability combined with disciplined engineering practices." },
        auditMetadata: { generatedAt: "2026-02-28T14:12:44Z", scoringModelVersion: "v1.3.0",
          dataSources: { interactionsAnalyzed: 23, outcomesAnalyzed: 23, s3MetricsPath: "metrics/cand_sample_01/summary.json" }
        }
      },
      {
        candidateId: "cand_sample_03",
        evaluationPeriod: { startDate: "2026-02-15", endDate: "2026-02-22", tasksCompleted: 8 },
        foundationalSignals: {
          contextQuality: { score: 90, fileCountAvg: 6.1, avgPromptLength: 710, questionsAsked: 8, clarityRating: 0.93 },
          analysisDepth: { score: 88, avgTimeToDecisionMs: 3420, followUpQuestions: 6, modificationRate: 0.73 },
          criticalThinking: { score: 92, rejectionRate: 0.33, highConfidenceRejectionRate: 0.09, modificationCount: 21, acceptedAfterModification: 15 },
          testCulture: { score: 93, testsRunBeforeAccept: 0.81, testsPassRateAfterEdit: 0.97, testCoverageChangeAvg: 0.09 },
          codeQuality: { score: 89, complexityReductionAvg: 0.24, duplicationReductionAvg: 0.26, lintIssuesIntroduced: 0 },
          decisionQuality: { score: 92, postEditFailureRate: 0.04, rollbackRate: 0.02, bugIntroductions: 0 }
        },
        compositeScores: {
          aiLeverageScore: { score: 93, description: "High leverage with strong filtering and validation." },
          problemSolverScore: { score: 92, description: "Excellent decomposition and edge-case handling." },
          engineerScore: { score: 94, description: "Strong test-first behavior and consistent quality improvements." }
        },
        behavioralClassification: "Systematic Thinker → High-Trust Engineer",
        riskFlags: [],
        strengths: ["Excellent requirement clarification", "Strong testing discipline"],
        areasForImprovement: ["Can shorten decision time for low-risk changes"],
        hiringRecommendation: { decision: "STRONG_HIRE", confidence: 0.93, rationale: "Top-tier validation habits and consistently high-quality decisions." },
        auditMetadata: { generatedAt: "2026-02-28T14:12:44Z", scoringModelVersion: "v1.3.0",
          dataSources: { interactionsAnalyzed: 28, outcomesAnalyzed: 28, s3MetricsPath: "metrics/cand_sample_03/summary.json" }
        }
      }
    ];
    state.filtered = [...state.reports];
    state.selectedIdx = -1;
    renderAll();
  }

  // Hidden shortcuts only (no UI text)
  document.addEventListener("keydown", (e) => {
    const mod = isMac() ? e.metaKey : e.ctrlKey;

    if (mod && e.key.toLowerCase() === "o") {
      e.preventDefault();
      el("fileInput").click();
      return;
    }

    if (mod && e.shiftKey && e.key.toLowerCase() === "s") {
      e.preventDefault();
      loadSampleHidden();
      return;
    }

    if (e.key === "Escape") {
      // back to stats if a report is open
      if (state.selectedIdx >= 0) {
        state.selectedIdx = -1;
        renderAll();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      return;
    }
  });

    state.reports = [  {    "candidateId": "cand_0a91b4d1",    "evaluationPeriod": { "startDate": "2026-02-10", "endDate": "2026-02-17", "tasksCompleted": 7 },    "foundationalSignals": {      "contextQuality": { "score": 78, "fileCountAvg": 3.1, "avgPromptLength": 436, "questionsAsked": 5, "clarityRating": 0.83 },      "analysisDepth": { "score": 74, "avgTimeToDecisionMs": 3110, "followUpQuestions": 3, "modificationRate": 0.55 },      "criticalThinking": { "score": 80, "rejectionRate": 0.22, "highConfidenceRejectionRate": 0.08, "modificationCount": 11, "acceptedAfterModification": 7 },      "testCulture": { "score": 84, "testsRunBeforeAccept": 0.62, "testsPassRateAfterEdit": 0.91, "testCoverageChangeAvg": 0.05 },      "codeQuality": { "score": 79, "complexityReductionAvg": 0.12, "duplicationReductionAvg": 0.17, "lintIssuesIntroduced": 1 },      "decisionQuality": { "score": 82, "postEditFailureRate": 0.08, "rollbackRate": 0.05, "bugIntroductions": 1 }    },    "compositeScores": {      "aiLeverageScore": { "score": 81, "description": "Uses AI as a drafting partner and refines output with moderate iteration." },      "problemSolverScore": { "score": 79, "description": "Validates assumptions and improves solutions, with occasional gaps in testing." },      "engineerScore": { "score": 82, "description": "Good engineering hygiene and review discipline; minor quality regressions occur." }    },    "behavioralClassification": "Thoughtful Collaborator → Balanced Executor",    "riskFlags": ["Occasional lint regressions"],    "strengths": ["Clarifies requirements with targeted questions", "Improves code readability and structure", "Uses tests for most medium-risk changes"],    "areasForImprovement": ["Increase test execution consistency on smaller refactors", "Reduce rework by clarifying earlier when scope is fuzzy"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.78, "rationale": "Strong overall profile with minor process improvements needed." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:01:10Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 19, "outcomesAnalyzed": 19, "s3MetricsPath": "metrics/cand_0a91b4d1/summary.json" }    }  },  {    "candidateId": "cand_1b7c2f90",    "evaluationPeriod": { "startDate": "2026-02-12", "endDate": "2026-02-19", "tasksCompleted": 4 },    "foundationalSignals": {      "contextQuality": { "score": 86, "fileCountAvg": 5.0, "avgPromptLength": 588, "questionsAsked": 7, "clarityRating": 0.90 },      "analysisDepth": { "score": 83, "avgTimeToDecisionMs": 2575, "followUpQuestions": 5, "modificationRate": 0.67 },      "criticalThinking": { "score": 89, "rejectionRate": 0.30, "highConfidenceRejectionRate": 0.10, "modificationCount": 16, "acceptedAfterModification": 11 },      "testCulture": { "score": 88, "testsRunBeforeAccept": 0.74, "testsPassRateAfterEdit": 0.95, "testCoverageChangeAvg": 0.06 },      "codeQuality": { "score": 85, "complexityReductionAvg": 0.20, "duplicationReductionAvg": 0.19, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 90, "postEditFailureRate": 0.05, "rollbackRate": 0.03, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 90, "description": "Strategically accepts high-confidence suggestions while shaping outputs to constraints." },      "problemSolverScore": { "score": 88, "description": "Strong reasoning, checks edge cases, and improves quality with iteration." },      "engineerScore": { "score": 91, "description": "Good testing discipline and minimal regressions; maintains high standards." }    },    "behavioralClassification": "Thoughtful Collaborator → Problem Solver",    "riskFlags": [],    "strengths": ["Asks clarifying questions early", "Balances speed with correctness", "Runs tests before merging changes"],    "areasForImprovement": ["Occasionally adds more complexity than needed for small features"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.89, "rationale": "High-quality work and disciplined validation patterns." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:02:30Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 22, "outcomesAnalyzed": 22, "s3MetricsPath": "metrics/cand_1b7c2f90/summary.json" }    }  },  {    "candidateId": "cand_2c4d8a11",    "evaluationPeriod": { "startDate": "2026-02-14", "endDate": "2026-02-21", "tasksCompleted": 6 },    "foundationalSignals": {      "contextQuality": { "score": 69, "fileCountAvg": 2.3, "avgPromptLength": 320, "questionsAsked": 2, "clarityRating": 0.71 },      "analysisDepth": { "score": 66, "avgTimeToDecisionMs": 1980, "followUpQuestions": 1, "modificationRate": 0.34 },      "criticalThinking": { "score": 70, "rejectionRate": 0.12, "highConfidenceRejectionRate": 0.04, "modificationCount": 6, "acceptedAfterModification": 3 },      "testCulture": { "score": 61, "testsRunBeforeAccept": 0.29, "testsPassRateAfterEdit": 0.84, "testCoverageChangeAvg": -0.01 },      "codeQuality": { "score": 68, "complexityReductionAvg": 0.05, "duplicationReductionAvg": 0.07, "lintIssuesIntroduced": 3 },      "decisionQuality": { "score": 65, "postEditFailureRate": 0.14, "rollbackRate": 0.09, "bugIntroductions": 2 }    },    "compositeScores": {      "aiLeverageScore": { "score": 66, "description": "Tends to accept suggestions quickly with limited validation." },      "problemSolverScore": { "score": 64, "description": "Solves straightforward issues; needs stronger reasoning under ambiguity." },      "engineerScore": { "score": 63, "description": "Testing and quality gates are inconsistent; regressions more likely." }    },    "behavioralClassification": "Fast Executor → Needs Guardrails",    "riskFlags": ["Low test execution rate", "Lint issues introduced", "Higher rollback rate"],    "strengths": ["Moves quickly on small changes", "Accepts feedback and iterates when prompted"],    "areasForImprovement": ["Run tests before accepting changes", "Ask clarifying questions earlier", "Reduce lint/format regressions"],    "hiringRecommendation": { "decision": "NO_HIRE", "confidence": 0.74, "rationale": "Risk of regressions due to limited validation and quality control." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:03:45Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 17, "outcomesAnalyzed": 17, "s3MetricsPath": "metrics/cand_2c4d8a11/summary.json" }    }  },  {    "candidateId": "cand_3ee91c0b",    "evaluationPeriod": { "startDate": "2026-02-15", "endDate": "2026-02-22", "tasksCompleted": 8 },    "foundationalSignals": {      "contextQuality": { "score": 90, "fileCountAvg": 6.1, "avgPromptLength": 710, "questionsAsked": 8, "clarityRating": 0.93 },      "analysisDepth": { "score": 88, "avgTimeToDecisionMs": 3420, "followUpQuestions": 6, "modificationRate": 0.73 },      "criticalThinking": { "score": 92, "rejectionRate": 0.33, "highConfidenceRejectionRate": 0.09, "modificationCount": 21, "acceptedAfterModification": 15 },      "testCulture": { "score": 93, "testsRunBeforeAccept": 0.81, "testsPassRateAfterEdit": 0.97, "testCoverageChangeAvg": 0.09 },      "codeQuality": { "score": 89, "complexityReductionAvg": 0.24, "duplicationReductionAvg": 0.26, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 92, "postEditFailureRate": 0.04, "rollbackRate": 0.02, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 93, "description": "High leverage: filters suggestions, refines implementation, and validates outcomes." },      "problemSolverScore": { "score": 92, "description": "Excellent decomposition, edge-case handling, and iterative improvement." },      "engineerScore": { "score": 94, "description": "Strong test-first behavior and consistent quality improvements." }    },    "behavioralClassification": "Systematic Thinker → High-Trust Engineer",    "riskFlags": [],    "strengths": ["Excellent requirement clarification", "Strong testing discipline", "Consistently improves maintainability"],    "areasForImprovement": ["Can shorten decision time for low-risk changes without sacrificing quality"],    "hiringRecommendation": { "decision": "STRONG_HIRE", "confidence": 0.93, "rationale": "Top-tier validation habits and consistently high-quality decisions." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:05:12Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 28, "outcomesAnalyzed": 28, "s3MetricsPath": "metrics/cand_3ee91c0b/summary.json" }    }  },  {    "candidateId": "cand_4a0f772e",    "evaluationPeriod": { "startDate": "2026-02-08", "endDate": "2026-02-15", "tasksCompleted": 3 },    "foundationalSignals": {      "contextQuality": { "score": 74, "fileCountAvg": 2.9, "avgPromptLength": 402, "questionsAsked": 3, "clarityRating": 0.79 },      "analysisDepth": { "score": 71, "avgTimeToDecisionMs": 2210, "followUpQuestions": 2, "modificationRate": 0.48 },      "criticalThinking": { "score": 77, "rejectionRate": 0.18, "highConfidenceRejectionRate": 0.06, "modificationCount": 9, "acceptedAfterModification": 5 },      "testCulture": { "score": 72, "testsRunBeforeAccept": 0.46, "testsPassRateAfterEdit": 0.89, "testCoverageChangeAvg": 0.02 },      "codeQuality": { "score": 75, "complexityReductionAvg": 0.10, "duplicationReductionAvg": 0.13, "lintIssuesIntroduced": 1 },      "decisionQuality": { "score": 76, "postEditFailureRate": 0.10, "rollbackRate": 0.06, "bugIntroductions": 1 }    },    "compositeScores": {      "aiLeverageScore": { "score": 75, "description": "Reasonable use of AI; improvements come from moderate iteration." },      "problemSolverScore": { "score": 73, "description": "Effective on known patterns; can struggle with under-specified requirements." },      "engineerScore": { "score": 74, "description": "Testing is inconsistent; quality generally acceptable." }    },    "behavioralClassification": "Balanced Executor",    "riskFlags": ["Inconsistent test runs"],    "strengths": ["Good baseline engineering", "Learns quickly from review feedback"],    "areasForImprovement": ["Improve upfront clarification", "Run tests more consistently"],    "hiringRecommendation": { "decision": "LEAN_HIRE", "confidence": 0.66, "rationale": "Solid baseline with some process gaps that appear coachable." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:06:45Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 14, "outcomesAnalyzed": 14, "s3MetricsPath": "metrics/cand_4a0f772e/summary.json" }    }  },  {    "candidateId": "cand_56c01d44",    "evaluationPeriod": { "startDate": "2026-02-18", "endDate": "2026-02-25", "tasksCompleted": 9 },    "foundationalSignals": {      "contextQuality": { "score": 82, "fileCountAvg": 4.4, "avgPromptLength": 540, "questionsAsked": 5, "clarityRating": 0.86 },      "analysisDepth": { "score": 85, "avgTimeToDecisionMs": 4120, "followUpQuestions": 4, "modificationRate": 0.70 },      "criticalThinking": { "score": 86, "rejectionRate": 0.27, "highConfidenceRejectionRate": 0.09, "modificationCount": 18, "acceptedAfterModification": 12 },      "testCulture": { "score": 79, "testsRunBeforeAccept": 0.58, "testsPassRateAfterEdit": 0.93, "testCoverageChangeAvg": 0.04 },      "codeQuality": { "score": 84, "complexityReductionAvg": 0.16, "duplicationReductionAvg": 0.21, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 87, "postEditFailureRate": 0.07, "rollbackRate": 0.04, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 86, "description": "Uses AI well and iterates thoughtfully, with occasional missing tests." },      "problemSolverScore": { "score": 85, "description": "Good depth and reasoning; improves solutions through targeted edits." },      "engineerScore": { "score": 84, "description": "Quality is strong; raising test consistency would reduce residual risk." }    },    "behavioralClassification": "Problem Solver",    "riskFlags": [],    "strengths": ["Strong improvement cycles", "Good architectural instincts", "Avoids unnecessary churn"],    "areasForImprovement": ["Run tests before accepting changes more consistently"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.84, "rationale": "Strong problem solving and quality; minor improvement in test discipline." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:08:09Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 25, "outcomesAnalyzed": 25, "s3MetricsPath": "metrics/cand_56c01d44/summary.json" }    }  },  {    "candidateId": "cand_6fd2a9c7",    "evaluationPeriod": { "startDate": "2026-02-06", "endDate": "2026-02-13", "tasksCompleted": 5 },    "foundationalSignals": {      "contextQuality": { "score": 88, "fileCountAvg": 5.6, "avgPromptLength": 650, "questionsAsked": 6, "clarityRating": 0.91 },      "analysisDepth": { "score": 77, "avgTimeToDecisionMs": 2050, "followUpQuestions": 2, "modificationRate": 0.44 },      "criticalThinking": { "score": 85, "rejectionRate": 0.31, "highConfidenceRejectionRate": 0.13, "modificationCount": 10, "acceptedAfterModification": 6 },      "testCulture": { "score": 69, "testsRunBeforeAccept": 0.41, "testsPassRateAfterEdit": 0.90, "testCoverageChangeAvg": 0.01 },      "codeQuality": { "score": 87, "complexityReductionAvg": 0.23, "duplicationReductionAvg": 0.18, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 81, "postEditFailureRate": 0.09, "rollbackRate": 0.05, "bugIntroductions": 1 }    },    "compositeScores": {      "aiLeverageScore": { "score": 83, "description": "Strong context ingestion and good edits; testing discipline lags." },      "problemSolverScore": { "score": 80, "description": "Good reasoning; should validate outcomes more often." },      "engineerScore": { "score": 78, "description": "Good code quality; moderate reliability risk without consistent tests." }    },    "behavioralClassification": "Strong Writer → Needs More Validation",    "riskFlags": ["Tests skipped on some changes"],    "strengths": ["Excellent context capture", "Improves code structure significantly"],    "areasForImprovement": ["Increase test runs before accept", "Add quick sanity checks for edge cases"],    "hiringRecommendation": { "decision": "LEAN_HIRE", "confidence": 0.71, "rationale": "High upside if validation habits improve." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:09:37Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 16, "outcomesAnalyzed": 16, "s3MetricsPath": "metrics/cand_6fd2a9c7/summary.json" }    }  },  {    "candidateId": "cand_7a2c13e8",    "evaluationPeriod": { "startDate": "2026-02-01", "endDate": "2026-02-08", "tasksCompleted": 10 },    "foundationalSignals": {      "contextQuality": { "score": 81, "fileCountAvg": 4.0, "avgPromptLength": 505, "questionsAsked": 4, "clarityRating": 0.85 },      "analysisDepth": { "score": 82, "avgTimeToDecisionMs": 2980, "followUpQuestions": 4, "modificationRate": 0.61 },      "criticalThinking": { "score": 79, "rejectionRate": 0.20, "highConfidenceRejectionRate": 0.07, "modificationCount": 14, "acceptedAfterModification": 9 },      "testCulture": { "score": 86, "testsRunBeforeAccept": 0.70, "testsPassRateAfterEdit": 0.96, "testCoverageChangeAvg": 0.06 },      "codeQuality": { "score": 80, "complexityReductionAvg": 0.14, "duplicationReductionAvg": 0.16, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 84, "postEditFailureRate": 0.06, "rollbackRate": 0.03, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 85, "description": "Uses AI effectively and validates with tests for most changes." },      "problemSolverScore": { "score": 82, "description": "Good reasoning and iteration; can improve rejection selectivity." },      "engineerScore": { "score": 86, "description": "Consistent testing and stable outcomes." }    },    "behavioralClassification": "Balanced Executor → Engineer",    "riskFlags": [],    "strengths": ["Good test habits", "Reliable delivery", "Improves maintainability gradually"],    "areasForImprovement": ["Be more willing to reject low-quality suggestions early"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.83, "rationale": "Reliable engineer with good validation discipline." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:10:58Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 24, "outcomesAnalyzed": 24, "s3MetricsPath": "metrics/cand_7a2c13e8/summary.json" }    }  },  {    "candidateId": "cand_8d33b6aa",    "evaluationPeriod": { "startDate": "2026-02-03", "endDate": "2026-02-10", "tasksCompleted": 2 },    "foundationalSignals": {      "contextQuality": { "score": 62, "fileCountAvg": 1.7, "avgPromptLength": 260, "questionsAsked": 1, "clarityRating": 0.65 },      "analysisDepth": { "score": 60, "avgTimeToDecisionMs": 1450, "followUpQuestions": 0, "modificationRate": 0.22 },      "criticalThinking": { "score": 63, "rejectionRate": 0.10, "highConfidenceRejectionRate": 0.03, "modificationCount": 3, "acceptedAfterModification": 1 },      "testCulture": { "score": 55, "testsRunBeforeAccept": 0.18, "testsPassRateAfterEdit": 0.80, "testCoverageChangeAvg": -0.03 },      "codeQuality": { "score": 61, "complexityReductionAvg": 0.02, "duplicationReductionAvg": 0.05, "lintIssuesIntroduced": 4 },      "decisionQuality": { "score": 58, "postEditFailureRate": 0.18, "rollbackRate": 0.12, "bugIntroductions": 3 }    },    "compositeScores": {      "aiLeverageScore": { "score": 59, "description": "Low leverage: tends to accept without sufficient validation." },      "problemSolverScore": { "score": 57, "description": "Needs deeper analysis and better clarifications to avoid mistakes." },      "engineerScore": { "score": 56, "description": "Quality regressions and weak test discipline increase risk." }    },    "behavioralClassification": "Fast Executor → High Risk",    "riskFlags": ["Very low testsRunBeforeAccept", "High postEditFailureRate", "Frequent lint issues"],    "strengths": ["Fast turnaround on simple tasks"],    "areasForImprovement": ["Adopt testing as default", "Ask clarifying questions", "Use lint/formatters consistently"],    "hiringRecommendation": { "decision": "NO_HIRE", "confidence": 0.82, "rationale": "High regression risk due to minimal validation and low context gathering." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:12:14Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 11, "outcomesAnalyzed": 11, "s3MetricsPath": "metrics/cand_8d33b6aa/summary.json" }    }  },  {    "candidateId": "cand_9f0a1c52",    "evaluationPeriod": { "startDate": "2026-02-05", "endDate": "2026-02-12", "tasksCompleted": 6 },    "foundationalSignals": {      "contextQuality": { "score": 85, "fileCountAvg": 4.8, "avgPromptLength": 605, "questionsAsked": 6, "clarityRating": 0.89 },      "analysisDepth": { "score": 80, "avgTimeToDecisionMs": 2760, "followUpQuestions": 4, "modificationRate": 0.60 },      "criticalThinking": { "score": 84, "rejectionRate": 0.26, "highConfidenceRejectionRate": 0.09, "modificationCount": 15, "acceptedAfterModification": 10 },      "testCulture": { "score": 90, "testsRunBeforeAccept": 0.78, "testsPassRateAfterEdit": 0.97, "testCoverageChangeAvg": 0.08 },      "codeQuality": { "score": 82, "complexityReductionAvg": 0.15, "duplicationReductionAvg": 0.18, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 88, "postEditFailureRate": 0.05, "rollbackRate": 0.03, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 88, "description": "High-quality collaboration with strong validation loops." },      "problemSolverScore": { "score": 84, "description": "Solid analysis and iteration with good edge-case thinking." },      "engineerScore": { "score": 90, "description": "Excellent test culture and reliable outcomes." }    },    "behavioralClassification": "Engineer → Problem Solver",    "riskFlags": [],    "strengths": ["Strong test discipline", "Good requirement clarification", "Avoids regressions"],    "areasForImprovement": ["Could reduce decision time on low-risk tasks"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.88, "rationale": "Strong engineering and validation behaviors; low risk." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:13:40Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 21, "outcomesAnalyzed": 21, "s3MetricsPath": "metrics/cand_9f0a1c52/summary.json" }    }  },  {    "candidateId": "cand_a13b99e0",    "evaluationPeriod": { "startDate": "2026-02-09", "endDate": "2026-02-16", "tasksCompleted": 7 },    "foundationalSignals": {      "contextQuality": { "score": 77, "fileCountAvg": 3.6, "avgPromptLength": 470, "questionsAsked": 4, "clarityRating": 0.82 },      "analysisDepth": { "score": 78, "avgTimeToDecisionMs": 3350, "followUpQuestions": 3, "modificationRate": 0.64 },      "criticalThinking": { "score": 81, "rejectionRate": 0.24, "highConfidenceRejectionRate": 0.10, "modificationCount": 12, "acceptedAfterModification": 8 },      "testCulture": { "score": 73, "testsRunBeforeAccept": 0.50, "testsPassRateAfterEdit": 0.92, "testCoverageChangeAvg": 0.03 },      "codeQuality": { "score": 78, "complexityReductionAvg": 0.11, "duplicationReductionAvg": 0.14, "lintIssuesIntroduced": 2 },      "decisionQuality": { "score": 79, "postEditFailureRate": 0.09, "rollbackRate": 0.05, "bugIntroductions": 1 }    },    "compositeScores": {      "aiLeverageScore": { "score": 79, "description": "Reasonable leverage with iterative edits; needs stronger quality gates." },      "problemSolverScore": { "score": 77, "description": "Good problem solving; can improve precision under ambiguity." },      "engineerScore": { "score": 76, "description": "Acceptable outcomes; some regressions due to inconsistent tests." }    },    "behavioralClassification": "Balanced Executor → Improving",    "riskFlags": ["Lint issues introduced"],    "strengths": ["Good iterative improvement", "Communicates tradeoffs clearly"],    "areasForImprovement": ["Run tests more consistently", "Reduce lint regressions via tooling"],    "hiringRecommendation": { "decision": "LEAN_HIRE", "confidence": 0.69, "rationale": "Coachability and solid baseline; needs stronger consistency in validation." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:15:05Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 18, "outcomesAnalyzed": 18, "s3MetricsPath": "metrics/cand_a13b99e0/summary.json" }    }  },  {    "candidateId": "cand_b2c4f6ad",    "evaluationPeriod": { "startDate": "2026-02-11", "endDate": "2026-02-18", "tasksCompleted": 5 },    "foundationalSignals": {      "contextQuality": { "score": 92, "fileCountAvg": 6.5, "avgPromptLength": 740, "questionsAsked": 9, "clarityRating": 0.95 },      "analysisDepth": { "score": 90, "avgTimeToDecisionMs": 4580, "followUpQuestions": 6, "modificationRate": 0.76 },      "criticalThinking": { "score": 91, "rejectionRate": 0.35, "highConfidenceRejectionRate": 0.12, "modificationCount": 20, "acceptedAfterModification": 14 },      "testCulture": { "score": 86, "testsRunBeforeAccept": 0.73, "testsPassRateAfterEdit": 0.96, "testCoverageChangeAvg": 0.07 },      "codeQuality": { "score": 90, "complexityReductionAvg": 0.25, "duplicationReductionAvg": 0.27, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 90, "postEditFailureRate": 0.05, "rollbackRate": 0.03, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 92, "description": "Excellent AI leverage with strong shaping and high-quality context." },      "problemSolverScore": { "score": 91, "description": "Deep, careful analysis with consistent improvement of solutions." },      "engineerScore": { "score": 89, "description": "Very strong hygiene; could run tests even more consistently." }    },    "behavioralClassification": "Systematic Thinker → Problem Solver",    "riskFlags": [],    "strengths": ["Top-tier context gathering", "High-quality refinements", "Strong architectural judgment"],    "areasForImprovement": ["Slightly increase test frequency on small tasks"],    "hiringRecommendation": { "decision": "STRONG_HIRE", "confidence": 0.91, "rationale": "Consistently strong across signals; highly reliable." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:16:33Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 27, "outcomesAnalyzed": 27, "s3MetricsPath": "metrics/cand_b2c4f6ad/summary.json" }    }  },  {    "candidateId": "cand_c7e1183f",    "evaluationPeriod": { "startDate": "2026-02-16", "endDate": "2026-02-23", "tasksCompleted": 6 },    "foundationalSignals": {      "contextQuality": { "score": 80, "fileCountAvg": 4.1, "avgPromptLength": 520, "questionsAsked": 5, "clarityRating": 0.84 },      "analysisDepth": { "score": 76, "avgTimeToDecisionMs": 2400, "followUpQuestions": 3, "modificationRate": 0.58 },      "criticalThinking": { "score": 82, "rejectionRate": 0.21, "highConfidenceRejectionRate": 0.07, "modificationCount": 13, "acceptedAfterModification": 8 },      "testCulture": { "score": 67, "testsRunBeforeAccept": 0.39, "testsPassRateAfterEdit": 0.90, "testCoverageChangeAvg": 0.02 },      "codeQuality": { "score": 81, "complexityReductionAvg": 0.17, "duplicationReductionAvg": 0.15, "lintIssuesIntroduced": 1 },      "decisionQuality": { "score": 78, "postEditFailureRate": 0.10, "rollbackRate": 0.06, "bugIntroductions": 1 }    },    "compositeScores": {      "aiLeverageScore": { "score": 80, "description": "Good edits and iteration; validation is the main gap." },      "problemSolverScore": { "score": 78, "description": "Good general problem solving; needs stronger confidence calibration." },      "engineerScore": { "score": 74, "description": "Quality is decent but regression risk exists when tests are skipped." }    },    "behavioralClassification": "Thoughtful Collaborator → Developing",    "riskFlags": ["Tests skipped on some changes"],    "strengths": ["Good balance of acceptance and modification", "Communicates assumptions clearly"],    "areasForImprovement": ["Increase test frequency", "Add small regression checks on risky edits"],    "hiringRecommendation": { "decision": "LEAN_HIRE", "confidence": 0.67, "rationale": "Solid candidate if validation behaviors become more consistent." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:18:02Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 20, "outcomesAnalyzed": 20, "s3MetricsPath": "metrics/cand_c7e1183f/summary.json" }    }  },  {    "candidateId": "cand_d0b3a24c",    "evaluationPeriod": { "startDate": "2026-02-17", "endDate": "2026-02-24", "tasksCompleted": 8 },    "foundationalSignals": {      "contextQuality": { "score": 87, "fileCountAvg": 5.2, "avgPromptLength": 615, "questionsAsked": 6, "clarityRating": 0.90 },      "analysisDepth": { "score": 86, "avgTimeToDecisionMs": 3700, "followUpQuestions": 5, "modificationRate": 0.72 },      "criticalThinking": { "score": 88, "rejectionRate": 0.29, "highConfidenceRejectionRate": 0.10, "modificationCount": 19, "acceptedAfterModification": 13 },      "testCulture": { "score": 92, "testsRunBeforeAccept": 0.80, "testsPassRateAfterEdit": 0.98, "testCoverageChangeAvg": 0.09 },      "codeQuality": { "score": 86, "complexityReductionAvg": 0.21, "duplicationReductionAvg": 0.20, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 91, "postEditFailureRate": 0.04, "rollbackRate": 0.02, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 91, "description": "Excellent balance of acceptance, modification, and validation." },      "problemSolverScore": { "score": 88, "description": "Strong reasoning and consistent improvements to solutions." },      "engineerScore": { "score": 93, "description": "Very reliable testing discipline and stable outcomes." }    },    "behavioralClassification": "Problem Solver → Engineer",    "riskFlags": [],    "strengths": ["Runs tests before and after edits", "Strong edge-case awareness", "High-quality code improvements"],    "areasForImprovement": ["Could simplify solutions slightly more often"],    "hiringRecommendation": { "decision": "STRONG_HIRE", "confidence": 0.90, "rationale": "Highly reliable engineer with strong validation and problem solving." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:19:33Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 26, "outcomesAnalyzed": 26, "s3MetricsPath": "metrics/cand_d0b3a24c/summary.json" }    }  },  {    "candidateId": "cand_e1f8c0d9",    "evaluationPeriod": { "startDate": "2026-02-20", "endDate": "2026-02-27", "tasksCompleted": 4 },    "foundationalSignals": {      "contextQuality": { "score": 83, "fileCountAvg": 4.3, "avgPromptLength": 530, "questionsAsked": 6, "clarityRating": 0.87 },      "analysisDepth": { "score": 79, "avgTimeToDecisionMs": 2890, "followUpQuestions": 4, "modificationRate": 0.63 },      "criticalThinking": { "score": 86, "rejectionRate": 0.28, "highConfidenceRejectionRate": 0.11, "modificationCount": 14, "acceptedAfterModification": 10 },      "testCulture": { "score": 88, "testsRunBeforeAccept": 0.72, "testsPassRateAfterEdit": 0.95, "testCoverageChangeAvg": 0.07 },      "codeQuality": { "score": 82, "complexityReductionAvg": 0.17, "duplicationReductionAvg": 0.21, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 87, "postEditFailureRate": 0.06, "rollbackRate": 0.03, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 87, "description": "Strong collaboration; good shaping and consistent validation." },      "problemSolverScore": { "score": 84, "description": "Solid reasoning and improvements; good confidence calibration." },      "engineerScore": { "score": 89, "description": "Strong testing habits and stable outcomes." }    },    "behavioralClassification": "Thoughtful Collaborator → Problem Solver",    "riskFlags": [],    "strengths": ["Good clarifying questions", "Strong test discipline", "Improves maintainability"],    "areasForImprovement": ["Occasionally over-iterates on low-impact changes"],    "hiringRecommendation": { "decision": "HIRE", "confidence": 0.86, "rationale": "Strong engineering fundamentals and reliable validation." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:21:02Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 23, "outcomesAnalyzed": 23, "s3MetricsPath": "metrics/cand_e1f8c0d9/summary.json" }    }  },  {    "candidateId": "cand_f3b2d1a0",    "evaluationPeriod": { "startDate": "2026-02-07", "endDate": "2026-02-14", "tasksCompleted": 6 },    "foundationalSignals": {      "contextQuality": { "score": 72, "fileCountAvg": 3.0, "avgPromptLength": 390, "questionsAsked": 3, "clarityRating": 0.77 },      "analysisDepth": { "score": 68, "avgTimeToDecisionMs": 2620, "followUpQuestions": 2, "modificationRate": 0.49 },      "criticalThinking": { "score": 73, "rejectionRate": 0.15, "highConfidenceRejectionRate": 0.06, "modificationCount": 8, "acceptedAfterModification": 4 },      "testCulture": { "score": 64, "testsRunBeforeAccept": 0.35, "testsPassRateAfterEdit": 0.87, "testCoverageChangeAvg": 0.00 },      "codeQuality": { "score": 70, "complexityReductionAvg": 0.07, "duplicationReductionAvg": 0.09, "lintIssuesIntroduced": 2 },      "decisionQuality": { "score": 69, "postEditFailureRate": 0.12, "rollbackRate": 0.07, "bugIntroductions": 2 }    },    "compositeScores": {      "aiLeverageScore": { "score": 70, "description": "Moderate leverage; needs better selectivity and validation." },      "problemSolverScore": { "score": 68, "description": "Can solve routine problems; struggles when requirements shift." },      "engineerScore": { "score": 66, "description": "More regressions due to inconsistent testing and linting." }    },    "behavioralClassification": "Executor → Needs Coaching",    "riskFlags": ["Inconsistent tests", "Higher postEditFailureRate"],    "strengths": ["Fast iteration when given clear requirements"],    "areasForImprovement": ["Ask clarifying questions earlier", "Run tests before acceptance", "Reduce lint/format regressions"],    "hiringRecommendation": { "decision": "NO_HIRE", "confidence": 0.69, "rationale": "Too many regressions without strong evidence of improving validation habits." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:22:27Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 15, "outcomesAnalyzed": 15, "s3MetricsPath": "metrics/cand_f3b2d1a0/summary.json" }    }  },  {    "candidateId": "cand_ff9e12ab",    "evaluationPeriod": { "startDate": "2026-02-04", "endDate": "2026-02-11", "tasksCompleted": 7 },    "foundationalSignals": {      "contextQuality": { "score": 89, "fileCountAvg": 5.4, "avgPromptLength": 640, "questionsAsked": 7, "clarityRating": 0.92 },      "analysisDepth": { "score": 84, "avgTimeToDecisionMs": 3010, "followUpQuestions": 5, "modificationRate": 0.71 },      "criticalThinking": { "score": 90, "rejectionRate": 0.32, "highConfidenceRejectionRate": 0.10, "modificationCount": 19, "acceptedAfterModification": 13 },      "testCulture": { "score": 91, "testsRunBeforeAccept": 0.79, "testsPassRateAfterEdit": 0.97, "testCoverageChangeAvg": 0.08 },      "codeQuality": { "score": 88, "complexityReductionAvg": 0.22, "duplicationReductionAvg": 0.24, "lintIssuesIntroduced": 0 },      "decisionQuality": { "score": 92, "postEditFailureRate": 0.04, "rollbackRate": 0.02, "bugIntroductions": 0 }    },    "compositeScores": {      "aiLeverageScore": { "score": 92, "description": "High leverage with strong shaping, rejection selectivity, and validation." },      "problemSolverScore": { "score": 90, "description": "Excellent reasoning and consistent solution improvements." },      "engineerScore": { "score": 92, "description": "Consistent testing and very low regression risk." }    },    "behavioralClassification": "Systematic Thinker → High-Trust Engineer",    "riskFlags": [],    "strengths": ["Excellent context + clarifications", "Strong test discipline", "Consistently improves maintainability"],    "areasForImprovement": ["Could speed up on low-risk refactors"],    "hiringRecommendation": { "decision": "STRONG_HIRE", "confidence": 0.92, "rationale": "High trust engineer profile with disciplined validation and strong judgment." },    "auditMetadata": {      "generatedAt": "2026-02-28T12:24:10Z",      "scoringModelVersion": "v1.3.0",      "dataSources": { "interactionsAnalyzed": 29, "outcomesAnalyzed": 29, "s3MetricsPath": "metrics/cand_ff9e12ab/summary.json" }    }  }]
    state.filtered = [...state.reports];
    state.selectedIdx = -1;
    renderAll();
  
</script>
</body>
</html>